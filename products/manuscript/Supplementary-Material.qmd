---
title: |
  Supplementary Material: 
  Exploring the effect of different dosing regimens of probenecid on influenza A infections with a quantitative systems pharmacology (QSP) model 
format:
  pdf:
    toc: true
    fontsize: "12"
bibliography:
  - ../../assets/probenecid-modeling.bib
csl: "../../assets/aje.csl"
execute: 
  echo: false
  message: false
  warning: false
lang: en-US
---


```{r, echo=FALSE, message=FALSE}
# load a few R packages
library(here)
library(knitr)
library(gt)
```


# Overview

This supplement file describes how to use the data and code to reproduce all findings.
It also contains additional results.



# Code and file information

All code and data needed to reproduce the results are provided as supplement.

The data in a format that is ready for modeling is located in the `processed-data` folder. 

Code in the `analysis-code` folder contains all scripts needed to fit the model and run the simulations. Any code that starts with `run-` is used to run the model fitting or simulations. These main scripts call other the function files, which all end in `-functions.R`.

Results from the two `run-` scripts are saved in the `results\output` folder as `.Rds` files. 

Code in the `plotting-code` folder contains all scripts to generate the figures and tables in the main text and supplement. Any file that starts with `make-` is used to generate specific figures/tables using the results from the prior scripts stored in the `results\output` folder. These scripts call other functions as needed, which all end in `-functions.R`. Figures and tables are saved in the `results\figures` and `results\tables` folders, respectively.

To reproduce the results, run the two `run-` scripts in the `analysis-code` folder, first the fitting script, then the simulation script. After that, you can run the different `make` scripts in the `plotting-code` folder in any order.

{{< pagebreak >}}


# Additional results

The following sections provide additional results from the model fitting and simulations.

## Table of parameter estimates

Estimates for parameter values that are fit to the model are provided in table @tbl-parametertab .


```{r}
#| label: tbl-parametertab
#| tbl-cap: "Best fit estimates of model parameters. For units, see the main text. The main text also provides information on those parameters that were fixed."
#| echo: FALSE
resulttable1 = readRDS(here("results", "tables", "parametertab1.rds"))
resulttable1
```


Values for fixed parameters are described in the methods section of the main text.

Additional tables of best fit estimates for all fixed parameter samples can be generated with the supplied code.


{{< pagebreak >}}


## Predicted versus observed plot

Figure @fig-predobs shows the (unweighted) predicted versus observed results for each fitted variable.

![Predicted versus observed variables for best fitting model.](../../results/figures/pred-vs-obs-combined1.png){#fig-predobs}

{{< pagebreak >}}


## Residual plots

Figures @fig-residual1 and @fig-residual2 show the weighted residual plots for the best fit model, one separated for each variable, and one combined.


![Per-variable weighted residual plot for best fitting model.](../../results/figures/residuals-nllweighted-panels1.png){#fig-residual1}


![Combined weighted residual plot for best fitting model.](../../results/figures/residuals-nllweighted-combined1.png){#fig-residual2}


{{< pagebreak >}}



## Time-series for delayed treatment regimens


@fig-result-tx2 shows time-series for all model variables for 1, 10 and 100mg/kg doses with treatment starting 2 days post infection. @fig-result-tx3 shows the same for treatment starting 3 days post infection.



![Time series of model simulations for several dosing levels with treatment starting 2 days post infection.](../../results/figures/timeseries-d2tx.png){#fig-result-tx2}

![Time series of model simulations for several dosing levels with treatment starting 3 days post infection.](../../results/figures/timeseries-d3tx.png){#fig-result-tx3}


{{< pagebreak >}}

## Time-series for reduced treatment regimens


@fig-result-tx4 shows time-series for all model variables for 1, 10 and 100mg/kg doses with daily (instead of twice daily) treatment starting on day 1 post infection. @fig-result-tx5 shows the same for a single treatment on day 1 post infection.



![Time series of model simulations for several dosing levels with daily treatment starting on day 1 post infection.](../../results/figures/timeseries-dailytx.png){#fig-result-tx4}


![Time series of model simulations for several dosing levels with a single treatment at day 1 post infection.](../../results/figures/timeseries-singletx.png){#fig-result-tx5}




{{< pagebreak >}}


# References



